{"updatedAt":"2025-11-12T17:51:52.000Z","createdAt":"2025-11-10T18:45:45.108Z","id":"yOjLrNTNp3CT45UG","name":"Backup de WorkFlows","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"24d32ad0-5ccf-4b87-b9f8-03add755a2a3","name":"When clicking â€˜Execute workflowâ€™"},{"parameters":{"rule":{"interval":[{"field":"hours","hoursInterval":12}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,224],"id":"2a8b3424-f553-4058-8f0e-680a2d7917cd","name":"Schedule Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"dc7130ce-9b54-420c-917a-9891dd175c9f","name":"repo.owner","value":"GonzaloFS8","type":"string"},{"id":"9724aeeb-4bec-4adc-8cdf-9b767849f417","name":"repo.name","value":"UDIA-N8N-WorkFlows","type":"string"},{"id":"555aac2d-d4cc-47a6-bcba-544e6608aafc","name":"repo.path","value":"workflows/","type":"string"},{"id":"76c1bacc-ac18-4177-abac-ab87cfb87e6c","name":"repo.branch","value":"main","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[384,96],"id":"97afb6c6-6f19-4d32-8ef5-f0de5feb3754","name":"Edit Fields"},{"parameters":{"filters":{},"requestOptions":{}},"type":"n8n-nodes-base.n8n","typeVersion":1,"position":[592,96],"id":"068fa813-81c0-410a-a54e-15a9a9ceac60","name":"Get many workflows","credentials":{"n8nApi":{"id":"I5KdGLKsixYONBtK","name":"n8n account"}}},{"parameters":{"resource":"file","operation":"get","owner":{"__rl":true,"value":"={{ $node[\"Edit Fields\"].json.repo.owner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $node[\"Edit Fields\"].json.repo.name }}","mode":"name"},"filePath":"={{ \n  ($node[\"Edit Fields\"].json.repo.path || 'workflows/').replace(/\\/?$/, '/') + \n  String($json.name).replace(/[^a-z0-9-_]/gi, '_') + '_' + \n  $json.id + '.json' \n}}","asBinaryProperty":false,"additionalParameters":{}},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[1264,96],"id":"6e271fa8-28cb-41ae-92b4-9038bf731f3f","name":"Get a file","webhookId":"ba1978a0-4f7e-4ac5-8719-fbc84ea106f7","credentials":{"githubApi":{"id":"Fk1b94EngJHAveyH","name":"GitHub account"}},"onError":"continueRegularOutput"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Fin","typeVersion":1,"position":[1200,-160],"id":"016179cd-69ba-415a-a314-86e5ef8cd319"},{"parameters":{"jsCode":"// Code node (JavaScript) â€” Merge en modo \"Append\"\n// Item A: workflow (getMany â†’ loop)  |  Item B: GitHub \"Get a file\" (puede venir 404)\n\nfunction isBase64(s) {\n  if (typeof s !== 'string') return false;\n  const t = s.replace(/\\s+/g, '');\n  return t.length > 0 && t.length % 4 === 0 && /^[A-Za-z0-9+/]+={0,2}$/.test(t);\n}\nfunction b64ToUtf8(s) {\n  try { return Buffer.from(s, 'base64').toString('utf8'); } catch { return null; }\n}\nfunction toObj(x) {\n  if (x == null) return undefined;\n  if (typeof x === 'object') return x;\n  if (typeof x === 'string') {\n    let txt = s = x;\n    if (isBase64(txt)) {\n      const dec = b64ToUtf8(txt);\n      if (dec != null) txt = dec;\n    }\n    try { return JSON.parse(txt); } catch { return undefined; }\n  }\n  return undefined;\n}\nfunction stableStringify(obj) {\n  const seen = new WeakSet();\n  const norm = (v) => {\n    if (v && typeof v === 'object') {\n      if (seen.has(v)) return '__cycle__';\n      seen.add(v);\n      if (Array.isArray(v)) return v.map(norm);\n      const out = {};\n      for (const k of Object.keys(v).sort()) out[k] = norm(v[k]);\n      return out;\n    }\n    return v;\n  };\n  return JSON.stringify(norm(obj));\n}\n\nconst wfItem = items.find(i => i?.json && i.json.id && i.json.name && i.json.nodes);\nconst ghItem = items.find(i => i !== wfItem);\nif (!wfItem) return items;\n\nconst wf = wfItem.json;\n\n// Datos de repo desde \"Edit Fields\" (Ãºltima ejecuciÃ³n; sin .item)\nconst repoOwner = $node[\"Edit Fields\"]?.json?.repo?.owner || '';\nconst repoName  = $node[\"Edit Fields\"]?.json?.repo?.name  || '';\nconst basePath  = $node[\"Edit Fields\"]?.json?.repo?.path  || 'workflows/';\nconst branch    = $node[\"Edit Fields\"]?.json?.repo?.branch || 'main';\n\n// Ruta destino\nconst safeName = String(wf.name).replace(/[^a-z0-9-_]/gi, '_');\nconst filename = `${safeName}_${wf.id}.json`;\nconst filePath = `${basePath}${basePath.endsWith('/') ? '' : '/'}${filename}`;\n\n// Nuevo contenido\nconst newObj = wf;\nconst newStr = stableStringify(newObj);\n\n// Tomar salida del \"Get a file\" (puede ser 404)\nlet ghError, ghRaw, ghNotFound, existingSha = null;\nif (ghItem?.json) {\n  const gj = ghItem.json;\n  ghError    = gj.error;\n  ghNotFound = gj.message === 'Not Found' || gj.status === 404;\n  ghRaw      = gj.content ?? gj.file?.content ?? gj.fileContent ?? gj.data?.content;\n\n  // Busca \"sha\" en cualquier nivel del objeto\n  function deepFindSha(o) {\n    if (!o || typeof o !== 'object') return null;\n    if (typeof o.sha === 'string') return o.sha;\n    for (const k of Object.keys(o)) {\n      const r = deepFindSha(o[k]);\n      if (r) return r;\n    }\n    return null;\n  }\n  existingSha = deepFindSha(gj);\n}\n\n// NO existe en GitHub â†’ crear\nif (ghError || ghNotFound || ghRaw == null || ghRaw === '') {\n  return [{\n    json: {\n      filename, filePath,\n      repoOwner, repoName, branch,\n      status: 'NOT_FOUND',\n      exists: false,\n      isDifferent: true,\n      newObject: newObj,\n      existingObject: null,\n      existingSha: null\n    }\n  }];\n}\n\n// SÃ existe â†’ comparar\nconst existingObj = toObj(ghRaw);\nif (!existingObj) {\n  // Remoto no es JSON parseable â†’ fuerza creaciÃ³n\n  return [{\n    json: {\n      filename, filePath,\n      repoOwner, repoName, branch,\n      status: 'NOT_FOUND',\n      exists: false,\n      isDifferent: true,\n      newObject: newObj,\n      existingObject: null,\n      existingSha: null\n    }\n  }];\n}\n\nconst isDifferent = newStr !== stableStringify(existingObj);\n\nreturn [{\n  json: {\n    filename, filePath,\n    repoOwner, repoName, branch,\n    status: isDifferent ? 'EXISTS_DIFFERENT' : 'EXISTS_SAME',\n    exists: true,\n    isDifferent,\n    newObject: newObj,\n    existingObject: existingObj,\n    existingSha: existingSha || null\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1728,-496],"id":"d4eacbcb-2dfc-47f1-a686-b628e46fdb9c","name":"Code in JavaScript"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[1520,-512],"id":"6f08de13-8237-4d52-99e0-b6d58a22798a","name":"Merge"},{"parameters":{"mode":"expression","output":"={{ $json.status === 'EXISTS_SAME'\n    ? 0\n    : $json.status === 'EXISTS_DIFFERENT'\n    ? 1\n    : $json.status === 'NOT_FOUND'\n    ? 2\n    : 3 }}"},"type":"n8n-nodes-base.switch","typeVersion":3.3,"position":[1984,-528],"id":"975b4f00-2041-45f0-9e83-beeff6e27e41","name":"Switch"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"same","typeVersion":1,"position":[2512,-128],"id":"d579ff2b-ad70-4b1e-a2b1-14e8aa826399"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"different","typeVersion":1,"position":[2384,112],"id":"7e2c9a8b-2f09-41be-a85b-a9166c3550ee"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"new","typeVersion":1,"position":[2016,400],"id":"abce0d21-3293-4596-8e42-7ccf993bb690"},{"parameters":{"resource":"file","owner":{"__rl":true,"value":"={{ $json.repoOwner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $json.repoName }}","mode":"name"},"filePath":"={{ $json.filePath }}","fileContent":"={{ JSON.stringify($json.newObject, null, 2) }}","commitMessage":"=Create {{$json.filename}}","additionalParameters":{"branch":{"branch":"={{ $json.branch }}"}}},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[2432,400],"id":"d0503c34-8a4d-4deb-a2b6-77b0b06be936","name":"Create a file","webhookId":"7b6a51d5-7962-4b9a-9ef7-84df6a3d4a79","credentials":{"githubApi":{"id":"Fk1b94EngJHAveyH","name":"GitHub account"}}},{"parameters":{"resource":"file","operation":"edit","owner":{"__rl":true,"value":"={{ $json.owner }}","mode":"name"},"repository":{"__rl":true,"value":"={{ $json.repo }}","mode":"name"},"filePath":"={{ \n  ($node[\"Edit Fields\"].json.repo.path || 'workflows/').replace(/\\/?$/, '/') + \n  String($items(\"Loop Over Items1\", 0, $itemIndex).json.name).replace(/[^a-z0-9-_]/gi, '_') + '_' + \n  $items(\"Loop Over Items1\", 0, $itemIndex).json.id + '.json' \n}}","fileContent":"={{ JSON.stringify($json.newObject, null, 2) }}","commitMessage":"=Update {{ $json.filename }}","additionalParameters":{"branch":{"branch":"={{ $node[\"Edit Fields\"].json.repo.branch || 'main' }}"}}},"type":"n8n-nodes-base.github","typeVersion":1.1,"position":[2688,96],"id":"48e76e0e-f58d-49fc-a77c-fa22025cd256","name":"Edit a file","webhookId":"a792e788-8d6a-4ef3-b349-ea2635eb96b4","credentials":{"githubApi":{"id":"Fk1b94EngJHAveyH","name":"GitHub account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d6773732-43dd-4b3a-b1d8-35445dd6eb00","leftValue":"={{ $json.statusCode === 404 }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1536,80],"id":"9314ffa9-bf6c-45d1-b241-8d891b775123","name":"If"},{"parameters":{"jsCode":"function stableStringify(obj){\n  const seen = new WeakSet();\n  const norm = v => {\n    if (v && typeof v === 'object'){\n      if (seen.has(v)) return '__cycle__';\n      seen.add(v);\n      if (Array.isArray(v)) return v.map(norm);\n      const o = {};\n      for (const k of Object.keys(v).sort()) o[k] = norm(v[k]);\n      return o;\n    }\n    return v;\n  };\n  return JSON.stringify(norm(obj));\n}\n\n// 1) Contenido remoto (Get a file)\nlet existingObj = null;\nif ($json.content) {\n  try {\n    const existingJsonStr = Buffer.from($json.content, 'base64').toString('utf8');\n    existingObj = JSON.parse(existingJsonStr);\n  } catch {}\n}\n\n// 2) Objeto nuevo del loop\nconst loopName = \"Loop Over Items1\"; // ðŸ‘ˆ cÃ¡mbialo si tu nodo se llama distinto\nconst loopItem = $items(loopName, 0, $itemIndex)?.json || {};\nconst newObj = loopItem.newObject ?? loopItem;\n\n// 3) ComparaciÃ³n\nconst isDifferent = !existingObj\n  ? true\n  : stableStringify(existingObj) !== stableStringify(newObj);\n\n// 4) Resultado\nreturn [{ json: { ...$json, isDifferent, newObject: newObj } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1888,80],"id":"55678678-4b39-49a3-a36d-89f571476bbc","name":"Code in JavaScript1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2142abad-88d2-4b80-a7c7-9bdcdd9b743e","leftValue":"={{ $json.isDifferent === true }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2096,80],"id":"366cc1a1-a48c-4c56-932c-d32771c4fb61","name":"If1"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[800,96],"id":"bf5247e1-e46d-4564-9e6f-ff8e88327317","name":"Loop Over Items1"}],"connections":{"When clicking â€˜Execute workflowâ€™":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Get many workflows","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Get many workflows":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Fin":{"main":[[]]},"Get a file":{"main":[[{"node":"If","type":"main","index":0}]]},"Merge":{"main":[[]]},"Code in JavaScript":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[],[],[],[]]},"same":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"different":{"main":[[{"node":"Edit a file","type":"main","index":0}]]},"new":{"main":[[{"node":"Create a file","type":"main","index":0}]]},"Edit a file":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"Create a file":{"main":[[{"node":"Loop Over Items1","type":"main","index":0}]]},"If":{"main":[[{"node":"new","type":"main","index":0}],[{"node":"Code in JavaScript1","type":"main","index":0}]]},"Code in JavaScript1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"different","type":"main","index":0}],[{"node":"same","type":"main","index":0}]]},"Loop Over Items1":{"main":[[{"node":"Fin","type":"main","index":0}],[{"node":"Get a file","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"5a1a37f1-d664-4317-aeb5-ca0646d26496","triggerCount":0,"shared":[{"updatedAt":"2025-11-10T18:45:45.108Z","createdAt":"2025-11-10T18:45:45.108Z","role":"workflow:owner","workflowId":"yOjLrNTNp3CT45UG","projectId":"kbsnYJQSz9jlxwjy"}],"tags":[]}